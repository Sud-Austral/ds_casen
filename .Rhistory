library(magrittr)
library(lubridate)
library(plotly)
library(xts)
library(dygraphs)
library(kableExtra)
library(knitr)
library("readxl")
library(rsconnect)
library(dplyr)
library(summarytools)
library(epiDisplay)
#library(leaflet)
library(haven)
library(epiDisplay)
library("readxl")
library(expss)
library(hrbrthemes)
library(viridis)
library(viridisLite)
library(DescTools)
library(roperators)
library(shinycssloaders)
library(writexl)
library(labelled)
library(tidyverse)
library(haven)
library(readr)
library(sjmisc)
library(WriteXLS)
library(readstata13)
casen_2006 <- readRDS(file = "casen_2006_c.rds")
casen_2006$EXPC
a <- casen_2006$COMUNA
b <- casen_2006$YAUTHAJ
c <- casen_2006$T4
d <- casen_2006$SEXO
#  e <- casen_2006$COMUNA
cross_tab =  xtabs(casen_2006$EXPC ~ unlist(a) + unlist(b),aggregate(casen_2006$EXPC ~ unlist(a)+unlist(b),dataset2015,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
head(d,10)
a <- casen_2006$COMUNA
b <- casen_2006$CORTE
c <- casen_2006$T4
d <- casen_2006$SEXO
#  e <- casen_2006$COMUNA
cross_tab =  xtabs(casen_2006$EXPC ~ unlist(a) + unlist(b),aggregate(casen_2006$EXPC ~ unlist(a)+unlist(b),dataset2015,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
head(d,10)
a <- casen_2006$COMUNA
b <- casen_2006$CORTE
c <- casen_2006$T4
d <- casen_2006$SEXO
#  e <- casen_2006$COMUNA
cross_tab =  xtabs(casen_2006$EXPC ~ unlist(a) + unlist(b),aggregate(casen_2006$EXPC ~ unlist(a)+unlist(b),dataset2015,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
a <- casen_2006$EXPC
# a <- casen_2006$COMUNA
# e <- casen_2006$codigo
b <- casen_2006$COMUNA
c <- casen_2006$CORTE
d <- casen_2006$SEXO
#  e <- casen_2006$COMUNA
cross_tab =  xtabs(a ~ unlist(b) + unlist(c),aggregate(a ~ unlist(b)+unlist(c),casen_2006,mean))
a <- casen_2006$EXPC
# a <- casen_2006$COMUNA
# e <- casen_2006$codigo
b <- casen_2006$COMUNA
c <- casen_2006$CORTE
d <- casen_2006$SEXO
#  e <- casen_2006$COMUNA
cross_tab =  xtabs(a ~ unlist(b),aggregate(a ~ unlist(b),casen_2006,mean))
ab <- casen_2006
a <- ab[,a]
ab <- casen_2006
a <- ab[,COMUNA]
casen_2006
casen_2006
ab <- casen_2006
a <- ab[,1]
cross_tab =  xtabs(ab$expc ~ unlist(a) + unlist(b)+unlist(c)+unlist(d),aggregate(ab$expc ~ unlist(a)+unlist(b)+unlist(c)+unlist(d),ab,mean))
ab <- casen_2006
a <- ab[,11]
b <- ab[,1]
cross_tab =  xtabs(ab$expc ~ unlist(a) + unlist(b),aggregate(ab$expc ~ unlist(a)+unlist(b),ab,mean))
ab <- casen_2006
a <- ab[,11]
b <- ab[,1]
cross_tab =  xtabs(ab$EXPC ~ unlist(a) + unlist(b),aggregate(ab$EXPC ~ unlist(a)+unlist(b),ab,mean))
ab <- casen_2006
a <- ab[,11]
b <- ab[,1]
cross_tab =  xtabs(ab$EXPC ~ unlist(a) + unlist(b),aggregate(ab$EXPC ~ unlist(a)+unlist(b),ab,mean))
cross_tab
ab <- casen_2006
a <- ab[,11]
b <- ab[,1]
cross_tab =  xtabs(ab$EXPC ~ unlist(a) + unlist(b),aggregate(ab$EXPC ~ unlist(a)+unlist(b),ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
a <- ab[,11]
b <- ab[,1]
cross_tab =  xtabs(ab$EXPC ~ unlist(b),aggregate(ab$EXPC ~ unlist(b),ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$EXPC
b <- ab[,1]
cross_tab =  xtabs(ab$EXPC ~ unlist(b),aggregate(ab$EXPC ~ unlist(b),ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$EXPC
b <- ab$COMUNA
cross_tab =  xtabs(ab$EXPC ~ unlist(b),aggregate(ab$EXPC ~ unlist(b),ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$EXPC
b <- ab$COMUNA
c <- ab$CORTE
cross_tab =  xtabs(ab$EXPC ~ unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$EXPC
d <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
cross_tab =  xtabs(ab$EXPC ~ unlist(b) +  unlist(d) + unlist(c) ,aggregate(ab$EXPC ~ unlist(b) +  unlist(d) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$EXPC
b <- ab$codigo
c <- ab$COMUNA
d <- ab$CORTE
e <- ab$T4
f <- ab$SEXO
cross_tab =  xtabs(a ~ unlist(b) +  unlist(c) + unlist(d) ,aggregate(a ~ unlist(b) +  unlist(c) + unlist(d) ,ab,mean))
ab <- casen_2006
# a <- ab[,11]
a <- ab$EXPC
b <- ab$codigo
c <- ab$COMUNA
d <- ab$CORTE
e <- ab$T4
f <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(b) +  unlist(c) + unlist(d) ,aggregate(ab$EXPC ~ unlist(b) +  unlist(c) + unlist(d) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- a
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- codigo
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
# names(d)[1] <- codigo
# names(d)[1] <- comuna
# names(d)[1] <- categoria
# names(d)[1] <- frecuencia
# names(d)[1] <- año
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- codigo
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- "codigo"
# names(d)[1] <- comuna
# names(d)[1] <- categoria
# names(d)[1] <- frecuencia
# names(d)[1] <- año
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- "codigo"
names(d)[2] <- "Comuna"
names(d)[3] <- "Categoria"
names(d)[4] <- "Frecuencia"
names(d)[5] <- "Año"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- "codigo"
names(d)[2] <- "Comuna"
names(d)[3] <- "Categoria"
names(d)[4] <- "Frecuencia"
names(d)[5] <- "Año"
d
ab <- casen_2006
# a <- ab[,11]
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- "codigo"
names(d)[2] <- "Comuna"
names(d)[3] <- "Categoria"
names(d)[4] <- "Etnia"
names(d)[5] <- "Año"
names(d)[6] <- "Frecuencia"
d
ab <- casen_2006
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T4
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2006"
names(d)[1] <- "Código"
names(d)[2] <- "Comuna"
names(d)[3] <- "Categoría"
names(d)[4] <- "Etnia"
names(d)[5] <- "Sexo"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d
casen_2009 <- read_sav("Casen2009.sav")
casen_2009_labeled  <- as_factor(casen_2009, only_labelled = TRUE)
data_code <- stack(attr(casen_2009$COMUNA, 'labels'))
data_code <- data_code[c(2,1)]
names(data_code)[2] <- "COMUNA"
head(data_code,10)
data_code <- stack(attr(casen_2009$COMUNA, 'labels'))
data_code <- data_code[c(2,1)]
names(data_code)[2] <- "codigo"
names(data_code)[1] <- "COMUNA"
head(data_code,10)
data_code[253,2]<-16102
data_code[149,2]<-16101
data_code[150,2]<-16103
data_code[305,2]<-16202
data_code[306,2]<-16203
data_code[44,2]<-16302
data_code[45,2]<-16104
data_code[106,2]<-5802
data_code[332,2]<-16204
data_code[46,2]<-16303
data_code[107,2]<-5803
data_code[47,2]<-16105
data_code[48,2]<-16106
data_code[307,2]<-16205
data_code[254,2]<-16107
data_code[98,2]<-5801
data_code[308,2]<-16201
data_code[309,2]<-16206
data_code[49,2]<-16301
data_code[310,2]<-16304
data_code[311,2]<-16108
data_code[255,2]<-16305
data_code[256,2]<-16207
data_code[99,2]<-5804
data_code[312,2]<-16109
df_final = merge( x = casen_2009_labeled, y = data_code, by = "COMUNA", all.x = TRUE)
saveRDS(df_final, file = "casen_2009_c.rds")
casen_2011 <- read_sav("Casen2011.sav")
casen_2011_labeled  <- as_factor(casen_2011, only_labelled = TRUE)
data_code <- stack(attr(casen_2011$comuna, 'labels'))
names(data_code)[2] <- "comuna"
data_code <- data_code[c(2,1)]
head(data_code,10)
data_code <- stack(attr(casen_2011$comuna, 'labels'))
data_code <- data_code[c(2,1)]
names(data_code)[2] <- "comuna"
names(data_code)[2] <- "comuna"
head(data_code,10)
data_code <- stack(attr(casen_2011$comuna, 'labels'))
data_code <- data_code[c(2,1)]
names(data_code)[1] <- "comuna"
names(data_code)[2] <- "codigo"
head(data_code,10)
data_code[171,2]<-16101
data_code[172,2]<-16102
data_code[173,2]<-16202
data_code[174,2]<-16203
data_code[175,2]<-16302
data_code[176,2]<-16103
data_code[177,2]<-16104
data_code[178,2]<-16204
data_code[179,2]<-16303
data_code[180,2]<-16105
data_code[181,2]<-16106
data_code[182,2]<-16205
data_code[183,2]<-16107
data_code[184,2]<-16201
data_code[185,2]<-16206
data_code[186,2]<-16301
data_code[187,2]<-16304
data_code[188,2]<-16108
data_code[189,2]<-16305
data_code[190,2]<-16207
data_code[191,2]<-16109
df_final = merge( x = casen_2011_labeled, y = data_code, by = "comuna", all.x = TRUE)
saveRDS(df_final, file = "casen_2011_c.rds")
casen_2013 <- read_sav("Casen2013.sav")
casen_2009 <- readRDS(file = "casen_2009_c.rds")
ab <- casen_2009
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$T5
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
tabla <- as.data.frame(cross_tab)
d <-tabla[!(tabla$Freq == 0),]
d$anio <- "2009"
names(d)[1] <- "Código"
names(d)[2] <- "Comuna"
names(d)[3] <- "Categoría"
names(d)[4] <- "Etnia"
names(d)[5] <- "Sexo"
names(d)[6] <- "Frecuencia"
names(d)[7] <- "Año"
d
casen_2013_labeled  <- as_factor(casen_2013, only_labelled = TRUE)
data_code <- stack(attr(casen_2013$comuna, 'labels'))
names(data_code)[2] <- "comuna"
head(data_code,10)
nrow(data_code)
data_code <- data_code[c(2,1)]
data_code
data_code <- stack(attr(casen_2013$comuna, 'labels'))
data_code <- data_code[c(2,1)]
names(data_code)[2] <- "comuna"
names(data_code)[2] <- "comuna"
data_code
data_code <- stack(attr(casen_2013$comuna, 'labels'))
data_code <- data_code[c(2,1)]
names(data_code)[1] <- "comuna"
names(data_code)[2] <- "codigo"
data_code
data_code[171,2]<-16101
data_code[172,2]<-16102
data_code[173,2]<-16202
data_code[174,2]<-16203
data_code[175,2]<-16302
data_code[176,2]<-16103
data_code[177,2]<-16104
data_code[178,2]<-16204
data_code[179,2]<-16303
data_code[180,2]<-16105
data_code[181,2]<-16106
data_code[182,2]<-16205
data_code[183,2]<-16107
data_code[184,2]<-16201
data_code[185,2]<-16206
data_code[186,2]<-16301
data_code[187,2]<-16304
data_code[188,2]<-16108
data_code[189,2]<-16305
data_code[190,2]<-16207
data_code[191,2]<-16109
df_final = merge( x = casen_2013_labeled, y = data_code, by = "comuna", all.x = TRUE)
saveRDS(df_final, file = "casen_2013_c.rds")
casen_2011 <- readRDS(file = "casen_2011_c.rds")
ab <- casen_2011
a <- ab$codigo
b <- ab$COMUNA
c <- ab$CORTE
d <- ab$r6
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
casen_2011
ab <- casen_2011
a <- ab$codigo
b <- ab$comuna
c <- ab$CORTE
d <- ab$r6
e <- ab$SEXO
cross_tab =  xtabs(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$EXPC ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
runApp('casen_rojo.R')
ab <- casen_2011
a <- ab$codigo
b <- ab$comuna
c <- ab$CORTE
d <- ab$r6
e <- ab$SEXO
cross_tab =  xtabs(ab$expc_full ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$expc_full ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
runApp('casen_rojo.R')
ab <- casen_2011
a <- ab$codigo
b <- ab$comuna
c <- ab$corte
d <- ab$r6
e <- ab$sexo
cross_tab =  xtabs(ab$expc_full ~ unlist(a) +  unlist(b) + unlist(c)  + unlist(d) + unlist(e),aggregate(ab$expc_full ~ unlist(a) +  unlist(b) + unlist(c) + unlist(d) + unlist(e) ,ab,mean))
ab <- casen_2011
a <- ab$codigo
b <- ab$comuna
c <- ab$corte
d <- ab$r6
e <- ab$sexo
casen_2011$codigo
casen_2011$comuna
casen_2011$corte
casen_2011$r6
casen_2011$sexo
casen_2011$expc_full
